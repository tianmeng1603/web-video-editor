{"version":3,"file":"static/js/419.b0087455.chunk.js","mappings":"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","sources":["components/VideoEditor/utils/audioExporter.ts"],"sourcesContent":["/**\r\n * Èü≥È¢ëÂØºÂá∫Ê®°Âùó\r\n * \r\n * ‰ΩøÁî®FFmpeg.wasmÂú®ÊµèËßàÂô®‰∏≠ÂØºÂá∫Èü≥È¢ëÔºåÊîØÊåÅÔºö\r\n * - ÂêàÊàêËßÜÈ¢ë‰∏≠ÁöÑÈü≥È¢ëËΩ®ÈÅì\r\n * - ÂêàÊàêÊâÄÊúâÈü≥È¢ëÁâáÊÆµ\r\n * - Â§öÁßçÈü≥È¢ëÊ†ºÂºèÔºàMP3, WAV, AAC, FLAC, AIFF, OGGÔºâ\r\n * - Ëá™ÂÆö‰πâÊØîÁâπÁéáÂíåÈááÊ†∑Áéá\r\n * - ÂÆûÊó∂ËøõÂ∫¶ÂèçÈ¶à\r\n */\r\n\r\nimport { FFmpeg } from '@ffmpeg/ffmpeg';\r\nimport { fetchFile } from '@ffmpeg/util';\r\nimport { MediaItem, TimelineClip } from \"../types\";\r\n\r\n/** FFmpegÂçï‰æãÂÆû‰æã */\r\nlet ffmpegInstance: FFmpeg | null = null;\r\n\r\n/**\r\n * Ëé∑ÂèñFFmpegÂÆû‰æãÔºàÂçï‰æãÊ®°ÂºèÔºâ\r\n */\r\nconst getFFmpeg = async (): Promise<FFmpeg> => {\r\n  if (ffmpegInstance) return ffmpegInstance;\r\n\r\n  ffmpegInstance = new FFmpeg();\r\n  ffmpegInstance.on('log', ({ message }) => console.log('[FFmpeg Audio]:', message));\r\n\r\n  const baseURL = 'https://unpkg.com/@ffmpeg/core@0.12.6/dist/umd';\r\n  await ffmpegInstance.load({\r\n    coreURL: `${baseURL}/ffmpeg-core.js`,\r\n    wasmURL: `${baseURL}/ffmpeg-core.wasm`,\r\n  });\r\n\r\n  console.log('‚úÖ FFmpeg (Audio) Âä†ËΩΩÂÆåÊàê');\r\n  return ffmpegInstance;\r\n};\r\n\r\n/**\r\n * Èü≥È¢ëÂØºÂá∫ÈÖçÁΩÆ\r\n */\r\nexport interface AudioExportOptions {\r\n  /** Èü≥È¢ëÊ†ºÂºè */\r\n  format: string;\r\n  /** ÊØîÁâπÁéá (kbps) */\r\n  bitrate: string;\r\n  /** ÈááÊ†∑Áéá (Hz) */\r\n  sampleRate: number;\r\n}\r\n\r\n/**\r\n * ÂØºÂá∫Èü≥È¢ë\r\n * \r\n * @param clips - Êó∂Èó¥ËΩ¥ÁâáÊÆµÂàóË°®\r\n * @param mediaItems - Â™í‰ΩìÁ¥†ÊùêÂàóË°®\r\n * @param onProgress - ËøõÂ∫¶ÂõûË∞ÉÂáΩÊï∞\r\n * @param options - ÂØºÂá∫ÈÖçÁΩÆÈÄâÈ°π\r\n * @returns ÂØºÂá∫ÁöÑÈü≥È¢ëBlob\r\n */\r\nexport const exportAudio = async (\r\n  clips: TimelineClip[],\r\n  mediaItems: MediaItem[],\r\n  onProgress: (progress: number) => void,\r\n  options: AudioExportOptions,\r\n  abortSignal?: AbortSignal\r\n): Promise<Blob> => {\r\n  console.log('üéµ ÂºÄÂßãÂØºÂá∫Èü≥È¢ë...');\r\n  console.log('ÂØºÂá∫ÈÖçÁΩÆ:', options);\r\n\r\n  // Ê£ÄÊü•ÊòØÂê¶Â∑≤Ë¢´‰∏≠Ê≠¢\r\n  if (abortSignal?.aborted) {\r\n    throw new DOMException('Export was cancelled', 'AbortError');\r\n  }\r\n\r\n  // Ë∑üË∏™ÂΩìÂâçËøõÂ∫¶ÔºåÁ°Æ‰øùËøõÂ∫¶Âè™Â¢û‰∏çÂáè\r\n  let currentProgress = 0;\r\n  const updateProgress = (progress: number) => {\r\n    if (progress > currentProgress) {\r\n      currentProgress = progress;\r\n      onProgress(progress);\r\n    }\r\n  };\r\n\r\n  // Á°Æ‰øù‰ªé0%ÂºÄÂßã\r\n  updateProgress(0);\r\n  await new Promise(resolve => setTimeout(resolve, 30));\r\n\r\n  // ÂàùÂßãÂåñ FFmpeg\r\n  updateProgress(3);\r\n  await new Promise(resolve => setTimeout(resolve, 20));\r\n\r\n  const ffmpeg = await getFFmpeg();\r\n\r\n  updateProgress(8);\r\n  await new Promise(resolve => setTimeout(resolve, 20));\r\n\r\n  // ËÆ°ÁÆóÊÄªÊó∂Èïø\r\n  updateProgress(10);\r\n  await new Promise(resolve => setTimeout(resolve, 20));\r\n\r\n  const maxClipEnd = clips.length > 0 ? Math.max(...clips.map(c => c.end)) : 0;\r\n  const duration = maxClipEnd;\r\n\r\n  if (duration === 0) {\r\n    throw new Error('Ê≤°ÊúâÂèØÂØºÂá∫ÁöÑÈü≥È¢ëÂÜÖÂÆπ');\r\n  }\r\n\r\n  console.log(`üìä È°πÁõÆÊÄªÊó∂Èïø: ${duration.toFixed(2)}Áßí`);\r\n\r\n  updateProgress(12);\r\n  await new Promise(resolve => setTimeout(resolve, 20));\r\n\r\n  // Êî∂ÈõÜÊâÄÊúâÈü≥È¢ëÊ∫êÔºàËßÜÈ¢ëÈü≥È¢ë + Á∫ØÈü≥È¢ëÔºâ\r\n  console.log('üîç ÂàÜÊûêÈü≥È¢ëËΩ®ÈÅì...');\r\n  updateProgress(14);\r\n  await new Promise(resolve => setTimeout(resolve, 20));\r\n\r\n  const audioSources: Array<{\r\n    clip: TimelineClip;\r\n    media: MediaItem;\r\n    url: string;\r\n  }> = [];\r\n\r\n  for (const clip of clips) {\r\n    const media = mediaItems.find(m => m.id === clip.mediaId);\r\n    if (!media || !media.url) continue;\r\n\r\n    // ËßÜÈ¢ëÂíåÈü≥È¢ëÁ±ªÂûãÈÉΩÂèØËÉΩÂåÖÂê´Èü≥È¢ëËΩ®ÈÅì\r\n    if (media.type === 'video' || media.type === 'audio') {\r\n      audioSources.push({\r\n        clip,\r\n        media,\r\n        url: media.url,\r\n      });\r\n    }\r\n  }\r\n\r\n  console.log(`üéº ÊâæÂà∞ ${audioSources.length} ‰∏™Èü≥È¢ëÊ∫ê`);\r\n\r\n  if (audioSources.length === 0) {\r\n    throw new Error('Ê≤°ÊúâÊâæÂà∞‰ªª‰ΩïÈü≥È¢ëËΩ®ÈÅì');\r\n  }\r\n\r\n  updateProgress(18);\r\n  await new Promise(resolve => setTimeout(resolve, 20));\r\n\r\n  updateProgress(20);\r\n  await new Promise(resolve => setTimeout(resolve, 30));\r\n\r\n  try {\r\n    // Á¨¨‰∏ÄÊ≠•ÔºöÂä†ËΩΩÊâÄÊúâÈü≥È¢ëÊñá‰ª∂Âà∞FFmpeg (20% -> 35%)\r\n    console.log('üì• ÂºÄÂßãÂä†ËΩΩÈü≥È¢ëÊñá‰ª∂...');\r\n    for (let i = 0; i < audioSources.length; i++) {\r\n      // Ê£ÄÊü•ÊòØÂê¶Ë¢´‰∏≠Ê≠¢\r\n      if (abortSignal?.aborted) {\r\n        console.log('üõë Èü≥È¢ëÂØºÂá∫Â∑≤Âú®Âä†ËΩΩÊñá‰ª∂Êó∂Ë¢´ÂèñÊ∂à');\r\n        throw new DOMException('Export was cancelled', 'AbortError');\r\n      }\r\n\r\n      const source = audioSources[i];\r\n      const inputFileName = `input_${i}.mp4`;\r\n\r\n      console.log(`üì• Âä†ËΩΩÈü≥È¢ëÊñá‰ª∂ ${i + 1}/${audioSources.length}: ${source.media.name}`);\r\n\r\n      const audioData = await fetchFile(source.url);\r\n      await ffmpeg.writeFile(inputFileName, audioData);\r\n\r\n      // Âä†ËΩΩÂêéÊõ¥Êñ∞ËøõÂ∫¶\r\n      const loadProgress = 20 + Math.floor(((i + 1) / audioSources.length) * 15);\r\n      updateProgress(loadProgress);\r\n\r\n      // ÊØè‰∏™Êñá‰ª∂Âä†ËΩΩÂêéÈÉΩÊ∑ªÂä†Âª∂Ëøü\r\n      await new Promise(resolve => setTimeout(resolve, 20));\r\n    }\r\n\r\n    updateProgress(35);\r\n    await new Promise(resolve => setTimeout(resolve, 20));\r\n\r\n    // Á¨¨‰∫åÊ≠•ÔºöÂàõÂª∫ÈùôÈü≥Âü∫Â∫ïÔºàÈ°πÁõÆÊÄªÊó∂ÈïøÁöÑÈùôÈü≥Èü≥È¢ëÔºâ\r\n    console.log('üîá ÂàõÂª∫ÈùôÈü≥Âü∫Â∫ï...');\r\n    updateProgress(37);\r\n    await new Promise(resolve => setTimeout(resolve, 20));\r\n\r\n    await ffmpeg.exec([\r\n      '-f', 'lavfi',\r\n      '-i', `anullsrc=r=${options.sampleRate}:cl=stereo`,\r\n      '-t', duration.toString(),\r\n      '-ar', options.sampleRate.toString(),\r\n      'silence.wav'\r\n    ]);\r\n\r\n    updateProgress(42);\r\n    await new Promise(resolve => setTimeout(resolve, 20));\r\n\r\n    // Á¨¨‰∏âÊ≠•ÔºöÂàõÂª∫ FFmpeg Êª§ÈïúÂ§çÊùÇÈìæ (42% -> 48%)\r\n    console.log('üéõÔ∏è ÊûÑÂª∫Êª§ÈïúÈìæ...');\r\n    updateProgress(44);\r\n    await new Promise(resolve => setTimeout(resolve, 20));\r\n\r\n    let filterComplex = '';\r\n    const mixInputs: string[] = ['[0:a]']; // ÈùôÈü≥Âü∫Â∫ïÔºàÊ≥®ÊÑèË¶ÅÂä†ÊñπÊã¨Âè∑Ôºâ\r\n\r\n    for (let i = 0; i < audioSources.length; i++) {\r\n      const source = audioSources[i];\r\n      const { clip } = source;\r\n\r\n      // ËÆ°ÁÆóË£ÅÂâ™ÂèÇÊï∞\r\n      const trimStart = clip.trimStart || 0;\r\n      const trimEnd = clip.trimEnd || (source.media.duration || clip.end - clip.start);\r\n\r\n      // ÂàõÂª∫Èü≥È¢ëÂ§ÑÁêÜÈìæÔºöË£ÅÂâ™ -> ËÆæÁΩÆÊó∂Èó¥Êà≥ -> Âª∂Ëøü\r\n      filterComplex += `[${i + 1}:a]atrim=start=${trimStart}:end=${trimEnd},asetpts=PTS-STARTPTS,adelay=${clip.start * 1000}|${clip.start * 1000}[a${i}];`;\r\n      mixInputs.push(`[a${i}]`);\r\n\r\n      // ÈÄêÊ≠•Êõ¥Êñ∞ËøõÂ∫¶\r\n      const filterProgress = 44 + Math.floor(((i + 1) / audioSources.length) * 4);\r\n      updateProgress(filterProgress);\r\n    }\r\n\r\n    // Ê∑∑ÂêàÊâÄÊúâÈü≥È¢ë\r\n    filterComplex += `${mixInputs.join('')}amix=inputs=${mixInputs.length}:duration=longest:dropout_transition=0[aout]`;\r\n\r\n    console.log('üéõÔ∏è FFmpeg Êª§ÈïúÈìæ:', filterComplex);\r\n\r\n    updateProgress(48);\r\n    await new Promise(resolve => setTimeout(resolve, 20));\r\n\r\n    // Á¨¨ÂõõÊ≠•ÔºöÊâßË°åÈü≥È¢ëÊ∑∑Âêà\r\n    const inputFiles = ['-i', 'silence.wav'];\r\n    for (let i = 0; i < audioSources.length; i++) {\r\n      inputFiles.push('-i', `input_${i}.mp4`);\r\n    }\r\n\r\n    // Ê†πÊçÆÊ†ºÂºèËÆæÁΩÆÁºñÁ†ÅÂèÇÊï∞\r\n    let codecArgs: string[] = [];\r\n    const formatLower = options.format.toLowerCase();\r\n\r\n    switch (formatLower) {\r\n      case 'mp3':\r\n        codecArgs = [\r\n          '-c:a', 'libmp3lame',\r\n          '-b:a', `${options.bitrate}k`,\r\n        ];\r\n        break;\r\n      case 'wav':\r\n        codecArgs = [\r\n          '-c:a', 'pcm_s16le',\r\n        ];\r\n        break;\r\n      case 'aac':\r\n        codecArgs = [\r\n          '-c:a', 'aac',\r\n          '-b:a', `${options.bitrate}k`,\r\n        ];\r\n        break;\r\n      case 'flac':\r\n        codecArgs = [\r\n          '-c:a', 'flac',\r\n        ];\r\n        break;\r\n      case 'aiff':\r\n        codecArgs = [\r\n          '-c:a', 'pcm_s16be',\r\n          '-f', 'aiff',\r\n        ];\r\n        break;\r\n      case 'ogg':\r\n        codecArgs = [\r\n          '-c:a', 'libvorbis',\r\n          '-b:a', `${options.bitrate}k`,\r\n        ];\r\n        break;\r\n      default:\r\n        codecArgs = [\r\n          '-c:a', 'libmp3lame',\r\n          '-b:a', `${options.bitrate}k`,\r\n        ];\r\n    }\r\n\r\n    // Ê£ÄÊü•ÊòØÂê¶Ë¢´‰∏≠Ê≠¢\r\n    if (abortSignal?.aborted) {\r\n      console.log('üõë Èü≥È¢ëÂØºÂá∫Â∑≤Âú®FFmpegÊâßË°åÂâçË¢´ÂèñÊ∂à');\r\n      throw new DOMException('Export was cancelled', 'AbortError');\r\n    }\r\n\r\n    console.log('üéöÔ∏è ÂºÄÂßãÊ∑∑ÂêàÈü≥È¢ë...');\r\n    updateProgress(50);\r\n    await new Promise(resolve => setTimeout(resolve, 20));\r\n\r\n    // FFmpeg progress‰∫ã‰ª∂ÁõëÂê¨ (50% -> 92%)\r\n    const progressHandler = ({ progress: prog }: { progress: number }) => {\r\n      // FFmpegËøõÂ∫¶‰ªé0Âà∞1ÔºåÊò†Â∞ÑÂà∞50%Âà∞92%\r\n      const encodingProgress = 50 + Math.floor(prog * 42);\r\n      updateProgress(Math.min(encodingProgress, 92));\r\n    };\r\n\r\n    ffmpeg.on('progress', progressHandler);\r\n\r\n    try {\r\n      await ffmpeg.exec([\r\n        ...inputFiles,\r\n        '-filter_complex', filterComplex,\r\n        '-map', '[aout]',\r\n        ...codecArgs,\r\n        '-ar', options.sampleRate.toString(),\r\n        '-t', duration.toString(),\r\n        `output.${formatLower}`\r\n      ]);\r\n    } finally {\r\n      // ÁßªÈô§ËøõÂ∫¶ÁõëÂê¨Âô®\r\n      ffmpeg.off('progress', progressHandler);\r\n    }\r\n\r\n    updateProgress(92);\r\n    await new Promise(resolve => setTimeout(resolve, 20));\r\n\r\n    // Á¨¨‰∫îÊ≠•ÔºöËØªÂèñËæìÂá∫Êñá‰ª∂ (92% -> 95%)\r\n    console.log('üì§ ËØªÂèñËæìÂá∫Êñá‰ª∂...');\r\n    updateProgress(94);\r\n    await new Promise(resolve => setTimeout(resolve, 20));\r\n\r\n    const data = await ffmpeg.readFile(`output.${formatLower}`) as Uint8Array;\r\n\r\n    updateProgress(96);\r\n    await new Promise(resolve => setTimeout(resolve, 20));\r\n\r\n    // Ê∏ÖÁêÜ‰∏¥Êó∂Êñá‰ª∂ (96% -> 98%)\r\n    console.log('üßπ Ê∏ÖÁêÜ‰∏¥Êó∂Êñá‰ª∂...');\r\n    try {\r\n      await ffmpeg.deleteFile('silence.wav');\r\n      updateProgress(97);\r\n\r\n      for (let i = 0; i < audioSources.length; i++) {\r\n        await ffmpeg.deleteFile(`input_${i}.mp4`);\r\n      }\r\n      updateProgress(98);\r\n\r\n      await ffmpeg.deleteFile(`output.${formatLower}`);\r\n    } catch (e) {\r\n      console.warn('Ê∏ÖÁêÜ‰∏¥Êó∂Êñá‰ª∂Â§±Ë¥•:', e);\r\n    }\r\n\r\n    updateProgress(99);\r\n    await new Promise(resolve => setTimeout(resolve, 30));\r\n\r\n    updateProgress(100);\r\n    await new Promise(resolve => setTimeout(resolve, 500));\r\n\r\n    // Á°ÆÂÆöMIMEÁ±ªÂûã\r\n    let mimeType = 'audio/mpeg';\r\n    switch (formatLower) {\r\n      case 'mp3': mimeType = 'audio/mpeg'; break;\r\n      case 'wav': mimeType = 'audio/wav'; break;\r\n      case 'aac': mimeType = 'audio/aac'; break;\r\n      case 'flac': mimeType = 'audio/flac'; break;\r\n      case 'aiff': mimeType = 'audio/aiff'; break;\r\n      case 'ogg': mimeType = 'audio/ogg'; break;\r\n    }\r\n\r\n    const blob = new Blob([new Uint8Array(data.buffer as ArrayBuffer)], { type: mimeType });\r\n    console.log('‚úÖ Èü≥È¢ëÂØºÂá∫ÂÆåÊàêÔºÅÊñá‰ª∂Â§ßÂ∞è:', (blob.size / 1024 / 1024).toFixed(2), 'MB');\r\n\r\n    return blob;\r\n  } catch (error) {\r\n    // Â¶ÇÊûúÊòØÂèñÊ∂àÊìç‰ΩúÔºåÁõ¥Êé•ÈáçÊñ∞ÊäõÂá∫Ôºå‰∏çÂåÖË£Ö\r\n    if (error instanceof DOMException && error.name === 'AbortError') {\r\n      console.log('üõë Èü≥È¢ëÂØºÂá∫Â∑≤ÂèñÊ∂à');\r\n      throw error;\r\n    }\r\n\r\n    console.error('‚ùå Èü≥È¢ëÂØºÂá∫Â§±Ë¥•:', error);\r\n    throw error;\r\n  }\r\n};\r\n\r\n"],"names":["ffmpegInstance","exportAudio","async","clips","mediaItems","onProgress","options","abortSignal","console","log","aborted","DOMException","currentProgress","updateProgress","progress","Promise","resolve","setTimeout","ffmpeg","FFmpeg","on","_ref","message","baseURL","load","coreURL","concat","wasmURL","getFFmpeg","duration","length","Math","max","map","c","end","Error","toFixed","audioSources","clip","media","find","m","id","mediaId","url","type","push","i","source","inputFileName","name","audioData","fetchFile","writeFile","loadProgress","floor","exec","sampleRate","toString","filterComplex","mixInputs","trimStart","trimEnd","start","filterProgress","join","inputFiles","codecArgs","formatLower","format","toLowerCase","bitrate","progressHandler","_ref2","prog","encodingProgress","min","off","data","readFile","deleteFile","e","warn","mimeType","blob","Blob","Uint8Array","buffer","size","error"],"sourceRoot":""}