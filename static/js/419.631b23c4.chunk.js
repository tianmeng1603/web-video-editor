"use strict";(self.webpackChunkweb_video_editor=self.webpackChunkweb_video_editor||[]).push([[419],{5419:(a,t,e)=>{e.d(t,{exportAudio:()=>l});var o=e(1123),c=e(6896);let n=null;const l=async(a,t,e,l)=>{console.log("\ud83c\udfb5 \u5f00\u59cb\u5bfc\u51fa\u97f3\u9891..."),console.log("\u5bfc\u51fa\u914d\u7f6e:",l);const i=await(async()=>{if(n)return n;n=new o.m,n.on("log",a=>{let{message:t}=a;return console.log("[FFmpeg Audio]:",t)});const a="https://unpkg.com/@ffmpeg/core@0.12.6/dist/umd";return await n.load({coreURL:"".concat(a,"/ffmpeg-core.js"),wasmURL:"".concat(a,"/ffmpeg-core.wasm")}),console.log("\u2705 FFmpeg (Audio) \u52a0\u8f7d\u5b8c\u6210"),n})();e(10);const r=a.length>0?Math.max(...a.map(a=>a.end)):0;if(0===r)throw new Error("\u6ca1\u6709\u53ef\u5bfc\u51fa\u7684\u97f3\u9891\u5185\u5bb9");console.log("\ud83d\udcca \u9879\u76ee\u603b\u65f6\u957f: ".concat(r.toFixed(2),"\u79d2"));const s=[];for(const o of a){const a=t.find(a=>a.id===o.mediaId);a&&a.url&&("video"!==a.type&&"audio"!==a.type||s.push({clip:o,media:a,url:a.url}))}if(console.log("\ud83c\udfbc \u627e\u5230 ".concat(s.length," \u4e2a\u97f3\u9891\u6e90")),0===s.length)throw new Error("\u6ca1\u6709\u627e\u5230\u4efb\u4f55\u97f3\u9891\u8f68\u9053");e(20);try{for(let e=0;e<s.length;e++){const a=s[e],t="input_".concat(e,".mp4");console.log("\ud83d\udce5 \u52a0\u8f7d\u97f3\u9891\u6587\u4ef6 ".concat(e+1,"/").concat(s.length,": ").concat(a.media.name));const o=await(0,c.t2)(a.url);await i.writeFile(t,o)}e(40),console.log("\ud83d\udd07 \u521b\u5efa\u9759\u97f3\u57fa\u5e95..."),await i.exec(["-f","lavfi","-i","anullsrc=r=".concat(l.sampleRate,":cl=stereo"),"-t",r.toString(),"-ar",l.sampleRate.toString(),"silence.wav"]),e(50);let a="";const t=["[0:a]"];for(let e=0;e<s.length;e++){const o=s[e],{clip:c}=o,n=c.trimStart||0,l=c.trimEnd||o.media.duration||c.end-c.start;a+="[".concat(e+1,":a]atrim=start=").concat(n,":end=").concat(l,",asetpts=PTS-STARTPTS,adelay=").concat(1e3*c.start,"|").concat(1e3*c.start,"[a").concat(e,"];"),t.push("[a".concat(e,"]"))}a+="".concat(t.join(""),"amix=inputs=").concat(t.length,":duration=longest:dropout_transition=0[aout]"),console.log("\ud83c\udf9b\ufe0f FFmpeg \u6ee4\u955c\u94fe:",a),e(60);const o=["-i","silence.wav"];for(let e=0;e<s.length;e++)o.push("-i","input_".concat(e,".mp4"));let n=[];const p=l.format.toLowerCase();switch(p){case"mp3":default:n=["-c:a","libmp3lame","-b:a","".concat(l.bitrate,"k")];break;case"wav":n=["-c:a","pcm_s16le"];break;case"aac":n=["-c:a","aac","-b:a","".concat(l.bitrate,"k")];break;case"flac":n=["-c:a","flac"];break;case"aiff":n=["-c:a","pcm_s16be","-f","aiff"];break;case"ogg":n=["-c:a","libvorbis","-b:a","".concat(l.bitrate,"k")]}console.log("\ud83c\udf9a\ufe0f \u5f00\u59cb\u6df7\u5408\u97f3\u9891..."),await i.exec([...o,"-filter_complex",a,"-map","[aout]",...n,"-ar",l.sampleRate.toString(),"-t",r.toString(),"output.".concat(p)]),e(90),console.log("\ud83d\udce4 \u8bfb\u53d6\u8f93\u51fa\u6587\u4ef6...");const g=await i.readFile("output.".concat(p));try{await i.deleteFile("silence.wav");for(let a=0;a<s.length;a++)await i.deleteFile("input_".concat(a,".mp4"));await i.deleteFile("output.".concat(p))}catch(u){console.warn("\u6e05\u7406\u4e34\u65f6\u6587\u4ef6\u5931\u8d25:",u)}e(100);let d="audio/mpeg";switch(p){case"mp3":d="audio/mpeg";break;case"wav":d="audio/wav";break;case"aac":d="audio/aac";break;case"flac":d="audio/flac";break;case"aiff":d="audio/aiff";break;case"ogg":d="audio/ogg"}const m=new Blob([new Uint8Array(g.buffer)],{type:d});return console.log("\u2705 \u97f3\u9891\u5bfc\u51fa\u5b8c\u6210\uff01\u6587\u4ef6\u5927\u5c0f:",(m.size/1024/1024).toFixed(2),"MB"),m}catch(p){throw console.error("\u274c \u97f3\u9891\u5bfc\u51fa\u5931\u8d25:",p),p}}}}]);
//# sourceMappingURL=419.631b23c4.chunk.js.map