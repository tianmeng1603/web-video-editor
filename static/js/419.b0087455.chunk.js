"use strict";(self.webpackChunkweb_video_editor=self.webpackChunkweb_video_editor||[]).push([[419],{5419:(e,t,o)=>{o.d(t,{exportAudio:()=>c});var a=o(1123),i=o(6896);let n=null;const c=async(e,t,o,c,s)=>{if(console.log("\ud83c\udfb5 \u5f00\u59cb\u5bfc\u51fa\u97f3\u9891..."),console.log("\u5bfc\u51fa\u914d\u7f6e:",c),null!==s&&void 0!==s&&s.aborted)throw new DOMException("Export was cancelled","AbortError");let r=0;const l=e=>{e>r&&(r=e,o(e))};l(0),await new Promise(e=>setTimeout(e,30)),l(3),await new Promise(e=>setTimeout(e,20));const w=await(async()=>{if(n)return n;n=new a.m,n.on("log",e=>{let{message:t}=e;return console.log("[FFmpeg Audio]:",t)});const e="https://unpkg.com/@ffmpeg/core@0.12.6/dist/umd";return await n.load({coreURL:"".concat(e,"/ffmpeg-core.js"),wasmURL:"".concat(e,"/ffmpeg-core.wasm")}),console.log("\u2705 FFmpeg (Audio) \u52a0\u8f7d\u5b8c\u6210"),n})();l(8),await new Promise(e=>setTimeout(e,20)),l(10),await new Promise(e=>setTimeout(e,20));const m=e.length>0?Math.max(...e.map(e=>e.end)):0;if(0===m)throw new Error("\u6ca1\u6709\u53ef\u5bfc\u51fa\u7684\u97f3\u9891\u5185\u5bb9");console.log("\ud83d\udcca \u9879\u76ee\u603b\u65f6\u957f: ".concat(m.toFixed(2),"\u79d2")),l(12),await new Promise(e=>setTimeout(e,20)),console.log("\ud83d\udd0d \u5206\u6790\u97f3\u9891\u8f68\u9053..."),l(14),await new Promise(e=>setTimeout(e,20));const u=[];for(const a of e){const e=t.find(e=>e.id===a.mediaId);e&&e.url&&("video"!==e.type&&"audio"!==e.type||u.push({clip:a,media:e,url:e.url}))}if(console.log("\ud83c\udfbc \u627e\u5230 ".concat(u.length," \u4e2a\u97f3\u9891\u6e90")),0===u.length)throw new Error("\u6ca1\u6709\u627e\u5230\u4efb\u4f55\u97f3\u9891\u8f68\u9053");l(18),await new Promise(e=>setTimeout(e,20)),l(20),await new Promise(e=>setTimeout(e,30));try{console.log("\ud83d\udce5 \u5f00\u59cb\u52a0\u8f7d\u97f3\u9891\u6587\u4ef6...");for(let c=0;c<u.length;c++){if(null!==s&&void 0!==s&&s.aborted)throw console.log("\ud83d\uded1 \u97f3\u9891\u5bfc\u51fa\u5df2\u5728\u52a0\u8f7d\u6587\u4ef6\u65f6\u88ab\u53d6\u6d88"),new DOMException("Export was cancelled","AbortError");const e=u[c],t="input_".concat(c,".mp4");console.log("\ud83d\udce5 \u52a0\u8f7d\u97f3\u9891\u6587\u4ef6 ".concat(c+1,"/").concat(u.length,": ").concat(e.media.name));const o=await(0,i.t2)(e.url);await w.writeFile(t,o);const a=20+Math.floor((c+1)/u.length*15);l(a),await new Promise(e=>setTimeout(e,20))}l(35),await new Promise(e=>setTimeout(e,20)),console.log("\ud83d\udd07 \u521b\u5efa\u9759\u97f3\u57fa\u5e95..."),l(37),await new Promise(e=>setTimeout(e,20)),await w.exec(["-f","lavfi","-i","anullsrc=r=".concat(c.sampleRate,":cl=stereo"),"-t",m.toString(),"-ar",c.sampleRate.toString(),"silence.wav"]),l(42),await new Promise(e=>setTimeout(e,20)),console.log("\ud83c\udf9b\ufe0f \u6784\u5efa\u6ee4\u955c\u94fe..."),l(44),await new Promise(e=>setTimeout(e,20));let e="";const t=["[0:a]"];for(let i=0;i<u.length;i++){const o=u[i],{clip:a}=o,n=a.trimStart||0,c=a.trimEnd||o.media.duration||a.end-a.start;e+="[".concat(i+1,":a]atrim=start=").concat(n,":end=").concat(c,",asetpts=PTS-STARTPTS,adelay=").concat(1e3*a.start,"|").concat(1e3*a.start,"[a").concat(i,"];"),t.push("[a".concat(i,"]"));const s=44+Math.floor((i+1)/u.length*4);l(s)}e+="".concat(t.join(""),"amix=inputs=").concat(t.length,":duration=longest:dropout_transition=0[aout]"),console.log("\ud83c\udf9b\ufe0f FFmpeg \u6ee4\u955c\u94fe:",e),l(48),await new Promise(e=>setTimeout(e,20));const o=["-i","silence.wav"];for(let i=0;i<u.length;i++)o.push("-i","input_".concat(i,".mp4"));let a=[];const n=c.format.toLowerCase();switch(n){case"mp3":default:a=["-c:a","libmp3lame","-b:a","".concat(c.bitrate,"k")];break;case"wav":a=["-c:a","pcm_s16le"];break;case"aac":a=["-c:a","aac","-b:a","".concat(c.bitrate,"k")];break;case"flac":a=["-c:a","flac"];break;case"aiff":a=["-c:a","pcm_s16be","-f","aiff"];break;case"ogg":a=["-c:a","libvorbis","-b:a","".concat(c.bitrate,"k")]}if(null!==s&&void 0!==s&&s.aborted)throw console.log("\ud83d\uded1 \u97f3\u9891\u5bfc\u51fa\u5df2\u5728FFmpeg\u6267\u884c\u524d\u88ab\u53d6\u6d88"),new DOMException("Export was cancelled","AbortError");console.log("\ud83c\udf9a\ufe0f \u5f00\u59cb\u6df7\u5408\u97f3\u9891..."),l(50),await new Promise(e=>setTimeout(e,20));const r=e=>{let{progress:t}=e;const o=50+Math.floor(42*t);l(Math.min(o,92))};w.on("progress",r);try{await w.exec([...o,"-filter_complex",e,"-map","[aout]",...a,"-ar",c.sampleRate.toString(),"-t",m.toString(),"output.".concat(n)])}finally{w.off("progress",r)}l(92),await new Promise(e=>setTimeout(e,20)),console.log("\ud83d\udce4 \u8bfb\u53d6\u8f93\u51fa\u6587\u4ef6..."),l(94),await new Promise(e=>setTimeout(e,20));const p=await w.readFile("output.".concat(n));l(96),await new Promise(e=>setTimeout(e,20)),console.log("\ud83e\uddf9 \u6e05\u7406\u4e34\u65f6\u6587\u4ef6...");try{await w.deleteFile("silence.wav"),l(97);for(let e=0;e<u.length;e++)await w.deleteFile("input_".concat(e,".mp4"));l(98),await w.deleteFile("output.".concat(n))}catch(g){console.warn("\u6e05\u7406\u4e34\u65f6\u6587\u4ef6\u5931\u8d25:",g)}l(99),await new Promise(e=>setTimeout(e,30)),l(100),await new Promise(e=>setTimeout(e,500));let d="audio/mpeg";switch(n){case"mp3":d="audio/mpeg";break;case"wav":d="audio/wav";break;case"aac":d="audio/aac";break;case"flac":d="audio/flac";break;case"aiff":d="audio/aiff";break;case"ogg":d="audio/ogg"}const f=new Blob([new Uint8Array(p.buffer)],{type:d});return console.log("\u2705 \u97f3\u9891\u5bfc\u51fa\u5b8c\u6210\uff01\u6587\u4ef6\u5927\u5c0f:",(f.size/1024/1024).toFixed(2),"MB"),f}catch(p){if(p instanceof DOMException&&"AbortError"===p.name)throw console.log("\ud83d\uded1 \u97f3\u9891\u5bfc\u51fa\u5df2\u53d6\u6d88"),p;throw console.error("\u274c \u97f3\u9891\u5bfc\u51fa\u5931\u8d25:",p),p}}}}]);
//# sourceMappingURL=419.b0087455.chunk.js.map